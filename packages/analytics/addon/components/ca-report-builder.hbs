{{#if (eq @slug "new")}}
  <ValidatedForm
    @on-submit={{fn @on-add this.tableSlug this.startingObject}}
    as |f|
  >
    <f.input
      @name="slug"
      @label={{t "caluma.analytics.report_title"}}
      @required={{true}}
      @on-update={{this.setTableSlug}}
    />
    <f.input
      @type="select"
      @name="startingObject"
      @label={{t "caluma.analytics.starting_object"}}
      @options={{@starting-objects}}
      @optionTargetPath="value"
      @optionValuePath="label"
      @value={{this.startingObject}}
      @on-update={{this.setStartingObject}}
    />
    <f.submit
      class="uk-margin-small"
      @lable={{t "caluma.analytics.list.new"}}
    />
  </ValidatedForm>
{{else}}
  <div ...attributes {{did-insert (perform this.fetchData)}}>
    {{#if this.fetchData.isRunnig}}
      <div class="uk-text-center"><UkSpinner @ratio={{1}} /></div>
    {{else if this.analyticsTable}}
      <ValidatedForm as |f|>
        <f.input
          @name="slug"
          @label={{t "caluma.analytics.report_title"}}
          @on-update={{this.setTableSlug}}
          @disabled={{true}}
          @value={{this.tableSlug}}
        />
        <f.input
          @type="select"
          @name="startingObject"
          @label={{t "caluma.analytics.starting_object"}}
          @options={{@starting-objects}}
          @optionTargetPath="value"
          @optionValuePath="label"
          @value={{this.startingObject}}
          @disabled={{true}}
        />
      </ValidatedForm>
      <hr />
      <ValidatedForm
        @model={{this.field}}
        @on-submit={{this.submitField}}
        as |f|
      >
        <f.input @label={{t "caluma.analytics.field_selection"}}>
          <div class="uk-grid-small uk-child-width-1-5" uk-grid>
            <CaFieldSelect
              @onSelect={{this.setFieldPath}}
              @selectedPath={{this.field.dataSource}}
              @slug={{@slug}}
            />
          </div>
          <CaFieldDetails
            @field={{this.field}}
            @onUpdate={{this.setFieldDescription}}
          />
        </f.input>
        <f.input
          @name="field_path"
          @label={{t "caluma.analytics.field_path"}}
          @value={{this.field.dataSource}}
          @disabled={{true}}
        />
        <f.submit @class="uk-margin-small-top" @disabled={{f.loading}}>
          <div class="uk-flex uk-flex-middle">
            <UkIcon @icon="plus" />
            {{t "caluma.analytics.add_field"}}
          </div>
        </f.submit>
      </ValidatedForm>
      <hr class="uk-divider-icon" />
      <CaFieldSelectorList
        @slug={{@slug}}
        @fields={{this.analyticsFields}}
        @onUpdate={{this.updateAnalyticsField}}
        @onDelete={{perform this.removeAnalyticsField}}
      />
    {{/if}}
  </div>
{{/if}}